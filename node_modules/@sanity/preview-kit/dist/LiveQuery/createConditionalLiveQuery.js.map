{"version":3,"file":"createConditionalLiveQuery.js","sources":["../../src/LiveQuery/createConditionalLiveQuery.tsx"],"sourcesContent":["import type { QueryParams as ClientQueryParams } from '@sanity/client'\nimport { Children, isValidElement } from 'react'\n\nimport type { LiveQueryClientComponentProps } from './LiveQueryClientComponent'\n\nexport type { ClientQueryParams, LiveQueryClientComponentProps }\n\nexport interface LiveQueryProps<\n  QueryResult,\n  QueryParams extends ClientQueryParams = ClientQueryParams,\n> extends LiveQueryClientComponentProps<QueryResult, QueryParams> {\n  enabled: boolean\n  // eslint-disable-next-line no-warning-comments\n  // @TODO fix typing of this\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  as?: React.ComponentType<any>\n}\n\nconst DEFAULT_PARAMS = {} as ClientQueryParams\n\n/**\n * @internal\n */\nexport function createConditionalLiveQuery<\n  QueryResult,\n  QueryParams extends ClientQueryParams = ClientQueryParams,\n>(options: {\n  ClientComponent: React.ComponentType<\n    LiveQueryClientComponentProps<QueryResult, QueryParams>\n  >\n}): React.ComponentType<LiveQueryProps<QueryResult, QueryParams>> {\n  const { ClientComponent } = options\n\n  function ConditionalLiveQuery<\n    QueryResult,\n    QueryParams extends ClientQueryParams = ClientQueryParams,\n  >(props: LiveQueryProps<QueryResult, QueryParams>): React.ReactNode {\n    // Always passthrough when not enabled\n    if (!props.enabled) {\n      return props.children\n    }\n\n    const {\n      query,\n      params = DEFAULT_PARAMS,\n      initialData,\n      as: LiveComponent,\n    } = props\n    // If we have an `as` prop it means we're likely working around a `children` that is RSC, and the `as` prop provides a Client Component\n    if (LiveComponent) {\n      if (Children.count(props.children) > 1) {\n        throw new Error(\n          'LiveQuery: `as` prop can only be used with a single child',\n        )\n      }\n      if (!isValidElement(props.children)) {\n        throw new Error('LiveQuery: `as` prop requires a valid `children` prop')\n      }\n\n      return (\n        <ClientComponent\n          // eslint-disable-next-line no-warning-comments\n          // @TODO improve the typing of this\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          initialData={initialData as any}\n          query={query}\n          // eslint-disable-next-line no-warning-comments\n          // @TODO improve the typing of this\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          params={params as any}\n        >\n          <LiveComponent {...props.children.props} />\n        </ClientComponent>\n      )\n    }\n\n    // Setup a `useLiveQuery` wrapper and override the `data` prop on the children component\n    return (\n      <ClientComponent\n        // eslint-disable-next-line no-warning-comments\n        // @TODO improve the typing of this\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        initialData={initialData as any}\n        query={query}\n        // eslint-disable-next-line no-warning-comments\n        // @TODO improve the typing of this\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        params={params as any}\n      >\n        {props.children}\n      </ClientComponent>\n    )\n  }\n  ConditionalLiveQuery.displayName = 'ConditionalLiveQuery'\n  return ConditionalLiveQuery\n}\n"],"names":["DEFAULT_PARAMS","createConditionalLiveQuery","options","ClientComponent","ConditionalLiveQuery","props","enabled","children","query","params","initialData","as","LiveComponent","Children","count","Error","isValidElement","jsx","displayName"],"mappings":";;AAkBA,MAAMA,iBAAiB,CAAA,CAAC;AAKjB,SAASC,2BAGdC,OAIgE,EAAA;EAC1D,MAAA;IAAEC;EAAoB,CAAA,GAAAD,OAAA;EAE5B,SAASE,qBAGPC,KAAkE,EAAA;IAE9D,IAAA,CAACA,MAAMC,OAAS,EAAA;MAClB,OAAOD,KAAM,CAAAE,QAAA;IACf;IAEM,MAAA;MACJC,KAAA;MACAC,MAAS,GAAAT,cAAA;MACTU,WAAA;MACAC,EAAI,EAAAC;IACF,CAAA,GAAAP,KAAA;IAEJ,IAAIO,aAAe,EAAA;MACjB,IAAIC,QAAS,CAAAC,KAAA,CAAMT,KAAM,CAAAE,QAAQ,IAAI,CAAG,EAAA;QACtC,MAAM,IAAIQ,KAAA,CACR,2DAAA,CACF;MACF;MACA,IAAI,CAACC,cAAA,CAAeX,KAAM,CAAAE,QAAQ,CAAG,EAAA;QAC7B,MAAA,IAAIQ,MAAM,uDAAuD,CAAA;MACzE;MAGE,sBAAAE,GAAA,CAACd,eAAA,EAAA;QAICO,WAAA;QACAF,KAAA;QAIAC,MAAA;QAEAF,QAAC,EAAA,eAAAU,GAAA,CAAAL,aAAA,EAAA;UAAe,GAAGP,KAAA,CAAME,SAASF;SAAO;MAAA,CAAA,CAC3C;IAEJ;IAIE,sBAAAY,GAAA,CAACd,eAAA,EAAA;MAICO,WAAA;MACAF,KAAA;MAIAC,MAAA;MAECF,QAAM,EAAAF,KAAA,CAAAE;IAAA,CAAA,CACT;EAEJ;EACAH,oBAAA,CAAqBc,WAAc,GAAA,sBAAA;EAC5B,OAAAd,oBAAA;AACT;"}