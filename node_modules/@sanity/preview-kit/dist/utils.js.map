{"version":3,"file":"utils.js","sources":["../src/utils.ts"],"sourcesContent":["import type { QueryParams } from '@sanity/client'\nimport {\n  startTransition,\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from 'react'\n\n/**\n * @internal\n */\nexport type QueryCacheKey = `${string}-${string}`\n/**\n * @internal\n */\nexport function getQueryCacheKey(\n  query: string,\n  params: QueryParams,\n): QueryCacheKey {\n  return `${query}-${JSON.stringify(params)}`\n}\n\n/**\n * Return params that are stable with deep equal as long as the key order is the same\n * @internal\n */\nexport function useParams(\n  params?: undefined | null | QueryParams,\n): QueryParams {\n  const stringifiedParams = useMemo(\n    () => JSON.stringify(params || {}),\n    [params],\n  )\n  return useMemo(() => JSON.parse(stringifiedParams), [stringifiedParams])\n}\n\n/**\n * @internal\n */\nexport function useLoadingListenersContext(\n  ready: Set<QueryCacheKey>,\n): [QueryCacheKey[], () => void] {\n  const [tick, forceUpdate] = useReducer((x) => x + 1, 0)\n  const mountedRef = useRef(true)\n  const scheduleUpdate = useCallback(() => {\n    if (mountedRef.current) {\n      startTransition(() => forceUpdate())\n    }\n  }, [])\n  useEffect(() => {\n    mountedRef.current = true\n    scheduleUpdate()\n    return () => {\n      mountedRef.current = false\n    }\n  }, [scheduleUpdate])\n  const loadedListenersContext = useMemo(\n    () => (tick ? [...ready] : []),\n    [ready, tick],\n  )\n\n  return [loadedListenersContext, scheduleUpdate]\n}\n\nexport const DEFAULT_MAX_DOCUMENTS = 3000\nexport const DEFAULT_TAG = 'sanity.preview-kit'\n"],"names":["getQueryCacheKey","query","params","concat","JSON","stringify","useParams","stringifiedParams","useMemo","parse","useLoadingListenersContext","ready","tick","forceUpdate","useReducer","x","mountedRef","useRef","scheduleUpdate","useCallback","current","startTransition","useEffect","loadedListenersContext","DEFAULT_MAX_DOCUMENTS","DEFAULT_TAG"],"mappings":";AAiBgB,SAAAA,gBAAAA,CACdC,OACAC,MACe,EAAA;EACf,OAAO,EAAG,CAAAC,MAAA,CAAAF,KAAA,EAAK,GAAI,CAAA,CAAAE,MAAA,CAAAC,IAAA,CAAKC,UAAUH,MAAM,CAAA,CAAA;AAC1C;AAMO,SAASI,UACdJ,MACa,EAAA;EACb,MAAMK,iBAAoB,GAAAC,OAAA,CACxB,MAAMJ,IAAA,CAAKC,SAAU,CAAAH,MAAA,IAAU,EAAE,CAAA,EACjC,CAACA,MAAM,CAAA,CACT;EACO,OAAAM,OAAA,CAAQ,MAAMJ,IAAK,CAAAK,KAAA,CAAMF,iBAAiB,CAAG,EAAA,CAACA,iBAAiB,CAAC,CAAA;AACzE;AAKO,SAASG,2BACdC,KAC+B,EAAA;EACzB,MAAA,CAACC,MAAMC,WAAW,CAAA,GAAIC,WAAYC,CAAA,IAAMA,CAAI,GAAA,CAAA,EAAG,CAAC,CAAA;EAChD,MAAAC,UAAA,GAAaC,OAAO,IAAI,CAAA;EACxB,MAAAC,cAAA,GAAiBC,YAAY,MAAM;IACvC,IAAIH,WAAWI,OAAS,EAAA;MACNC,eAAA,CAAA,MAAMR,aAAa,CAAA;IACrC;EACF,CAAA,EAAG,EAAE,CAAA;EACLS,SAAA,CAAU,MAAM;IACdN,UAAA,CAAWI,OAAU,GAAA,IAAA;IACNF,cAAA,EAAA;IACf,OAAO,MAAM;MACXF,UAAA,CAAWI,OAAU,GAAA,KAAA;IAAA,CACvB;EAAA,CACF,EAAG,CAACF,cAAc,CAAC,CAAA;EACnB,MAAMK,sBAAyB,GAAAf,OAAA,CAC7B,MAAOI,IAAO,GAAA,CAAC,GAAGD,KAAK,IAAI,EAAC,EAC5B,CAACA,OAAOC,IAAI,CAAA,CACd;EAEO,OAAA,CAACW,wBAAwBL,cAAc,CAAA;AAChD;AAEO,MAAMM,qBAAwB,GAAA,GAAA;AAC9B,MAAMC,WAAc,GAAA,oBAAA;"}